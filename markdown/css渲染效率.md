> 上节提到了Repaint和Reflow，以及如何优化的问题。我们知道浏览器工作流程第三步就是解析css然后计算元素位置并放置，那么如何从这点上来提高效率呢？这就要提到css的渲染效率了，本节我们来探讨下。  

### 浏览器如何识别你的选择器
我在查阅相关资料的时候，看到一篇文章，是Chris Coyier的[《Efficiently Rendering CSS》](https://css-tricks.com/efficiently-rendering-css/) 。文中提到`浏览器读取你的选择器，遵循的原则就是从选择器的右边到左边读取。换句话说，浏览器读取选择器的顺序是由右到左进行`。举个栗子：  
```
div.header > ul li p
```
上述选择器，浏览器会尝试在你的html标签中寻找**p**元素,接着匹配**li**和**ul**，最后再去匹配**div.header**,所谓的**由右到左**就是这样。
选择器的最后一部分，也就是最右边的部分被称为**关键选择器**，而它决定着你的选择器效率的高低。而关键选择器的作用就是提高选择器的效率，每少检查一个给定的规则，就会更有效的将样式匹配给对应的html元素。所以我们的方向就是让关键选择器更加有效性能化更高，那么如何实现呢？很简单，**关键选择器越具体，性能化就越高**。
### 选择器效率
如果你稍微接触过一段时间前端，对css选择器有一定了解的话，就会对那些选择器以及它的优先级不会太陌生。
来让我们看下[Steve Souders](http://stevesouders.com/)大神给的优先级排序：
1. id选择器 (#id)
2. 类选择器 (.class)
3. 标签选择器 (h1,div,p..)
4. 相邻选择器 (h1+p)
5. 子选择器 (div < span)
6. 后代选择器 (div span)
7. 通配符选择器 (*)
8. 属性选择器 (a[rel=''])
9. 伪类选择器 (a:hover,li:nth-child(1))  
上述选择器优先级按照降序排列，当然还有上面你没提到的行内样式和!important，笔者建议还是少用为妙，毕竟对于维护来讲太恶心。
### 如何书写高效的css选择器
#### 来自Mozilla的几点建议
David在[《Use efficient CSS selectors》](http://code.google.com/speed/page-speed/docs/rendering.html)中介绍了几种书写高效率的CSS选择器的方法，下面我将他们移到这里来让大家参考：
1. 避免普遍规则
2. 不要在ID选择器前加标签名或类名
3. 不要在类名选择器前加标签名
4. 尽可能使用具体的类别
5. 避免使用后代选择器
6. 标签分类规则中不应该包含一个子选择器
7. 子选择器的问题
8. 借助相关继承关系
9. 使用范围内的样式表
#### 一些降低渲染资源消耗的实战经验
1. **十六进制颜色值对位数与大小写**
	默认标准是大写以及6位数标注，建议书写规范，虽然未有确实数据表明不采用写法会对渲染速率有影响。
2. **display 与 visibility 差异**
	两者均用于设置或检索是否显示对象。前者隐藏对象且不保留物理空间，而后者会保存物理空间。浏览器渲染被占据的物理空间时，会有所消耗。建议采用display:none;
3. **border:none; 与 border:0;区别**
	区别同上；border:0;把border设为“0”像素虽然在页面上看不见，但按border默认值理解，浏览器依然对border-width/border-color进行了渲染，即已经占用了内存值。border:none;把border设为“none”即没有，浏览器解析“none”时将不作出渲染动作，即不会消耗内存值。
	建议使用border:none;
4. **不宜过小的图片平铺**
	一张宽高1px的背景图片，虽然文件体积非常之小，但渲染宽高500px的板块需要重复平铺2500次。提高背景图片渲染效率跟图片尺寸及体积有关，最大的图片文件体积保持约70KB。建议采用衡量适中体积及尺寸的背景图片
5. **IE的滤镜**
	IE的滤镜除了比较消耗资源外也有兼容性问题。当中有令PNG透明的滤镜，可采用GIF或JPG似透非透的办法来避免使用此滤镜。建议只在IE6应用GIF透明，因为IE7以上已经支持了PNG透明。
6. **通配符*{margin:0;padding:0;}**
	*号通配符把所有标签都初始化一遍，浏览器的渲染消耗一定的资源。有部分在标签在不同浏览器上几乎无差异，或是某些已经不推荐使用的标签(因为你不会去用它)，它们不需通配符要重新初始化一遍这样做能节省一点资源。
	推荐方案(代替reset)：normalize.css(如果没听说过自行百度)
7. **不要添加额外的标签来描述class或id**
	如果你有一个选择器是以id作为关键选择符，请不要添加多余标签名上去。因为ID是唯一的，你不要为了一个不存在的理由而降低了匹配的效率。  

	- 不赞成 - button#backButton { }
	- 不赞成 - .menu-left #newMenuIcon { }
	- 建议用 - #backButton { }
	- 建议用 - #newMenuIcon { }  

8. **尽量选择最特殊的类来存放选择器**
	降低系统效率的一个最大原因是我们在标签类中用了过多的选择符。通过添加 class 到元素，我们可以将类别进行再细分为 class 类，这样就不用为了一个标签浪费时间去匹配过多的选择符了。

	- 不赞成 - treeitem[mailfolder=”true”] > treerow > treecell { }
	- 建议用 - .treecell-mailfolder { }

9. **避免子孙选择符**

	子孙选择符是CSS中最耗资源的选择符。他真的是非常的耗资源，尤其是在选择器使用标签类或通用类的时候。很多情况中，我们真正想要的是子选择符。除非有明确说明，在 UI CSS 中是严禁使用子孙选择符的。

	- 不赞成 - treehead treerow treecell { }
	- 好一点，但还是不行(参照下一条) - treehead > treerow > treecell { }

10. **标签类中不要包含子选择符**

	不要在标签类中使用子选择符。否则，每次元素的出现，都会额外地增加匹配时间。（特别是当选择器似乎多半会被匹配的情况下）

	- 不赞成 - treehead > treerow > treecell { }
	- 建议用 - .treecell-header { }  


11. **留意所有子选择符的使用**

	小心地使用子选择符。如果你能想出一个的不使用他的方法，那么就不要使用。特别是在 RDF 树和菜单会频繁地使用子选择符，像这样。
	
	- 不赞成 - treeitem[IsImapServer=”true”] > treerow > .tree-folderpane-icon { }
		请记住 RDF 的属性是可以在模板中被复制的！利用这一点，我们可以复制那些想基于该属性改变的子 XUL 元素上的 RDF 属性。
	- 建议用 - .tree-folderpane-icon[IsImapServer=”true”] { }
